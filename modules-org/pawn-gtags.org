#+TITLE:GNU Global
#+OPTIONS: toc:2 num:nil ^:nil
| precondition | repository |
|--------------+------------|
| global       | AUR        |

| packages |
|----------|
| ggtags   |
* Config
#+BEGIN_SRC emacs-lisp
(use-package ggtags :ensure t :diminish ggtags-mode)

(defun gtags-root-dir ()
  "Returns GTAGS root directory or nil if doesn't exist."
    (with-temp-buffer
      (if (zerop (call-process "global" nil t nil "-pr"))
          (buffer-substring (point-min) (1- (point-max)))
        nil)))

(defun gtags-update-single (filename)
  "Update Gtags database for changes in a single file"
  (interactive)
  (start-process "update-gtags" "update-gtags" "bash" "-c"
                 (concat "cd "
                         (gtags-root-dir)
                         " ; gtags --single-update "
                         filename )))

(defun gtags-update-current-file()
  (interactive)
  (let ((filename (replace-regexp-in-string
                   (gtags-root-dir)
                   "."
                   (buffer-file-name (current-buffer)))))
    (gtags-update-single filename)
    (message "Gtags updated for %s" filename)))

(defun gtags-update-hook()
  "Update GTAGS file incrementally upon saving a file"
  (when ggtags-mode
    (when (gtags-root-dir)
      (gtags-update-current-file))))

(with-eval-after-load "ggtags"
  (add-hook 'after-save-hook #'gtags-update-hook))

(add-hook 'c-mode-common-hook 'ggtags-mode)
#+END_SRC

* Keybindings
ggtags의 함수는 ~(C-u)~ 와 함께 사용해서 커서의 위치가 아닌, 지정한 태그를 검색하는 것이 가능하다.
~(M-.)~ ggtags-find-tag-dwim
위의 함수는 reference와 definition을 번갈아 가며 찾아준다.

~(C-M-.)~ ggtags-find-tag-regexp
~(C-c M-o)~ ggtags-find-other-symbol 뭔지 모르겠다. "Find tags that have no definitions"
~(C-c M-f)~ ggtags-find-file
~(C-c M-%)~ ggtags-query-replace

~(M-*)~, ~(C-c M-p)~ ggtags-prev-mark
~(C-c M-n)~ ggtags-next-mark
~pop-tag-mark~ 이것을 ~(M-,)~ 에 두고 사용하는 것도 나쁘지 않을 지도 모른다.

~C-c M-/~ ggtags-view-search-history
~C-c M-h~ ggtags-view-tag-history

~C-c M-j~ ggtags-visit-project-root

~C-c M-k~ ggtags-kill-file-buffers "Kill all file-visiting buffers of current project."
* Reference
[[http://tip.daum.net/openknow/3863655][etags와 ctags를 이용하여 C/c++ 소스 빨리 분석하기]]
[[https://bbingju.wordpress.com/2013/03/21/emacs-global-gtags-source-navigation/][Emacs에서 GNU Global과 gtags를 이용한 source navigation]]
